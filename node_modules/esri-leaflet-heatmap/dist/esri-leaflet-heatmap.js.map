{"version":3,"file":"esri-leaflet-heatmap.js","sources":["../package.json","../src/HeatmapFeatureLayer.js"],"sourcesContent":["{\n  \"name\": \"esri-leaflet-heatmap\",\n  \"description\": \"Esri Leaflet plugin for visualizing Feature Layers as heatmaps with L.heat.\",\n  \"version\": \"2.0.0\",\n  \"author\": \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\n  \"contributors\": [\n    \"Patrick Arlt <parlt@esri.com> (http://patrickarlt.com)\",\n    \"John Gravois <jgravois@esri.com> (http://johngravois.com)\"\n  ],\n  \"dependencies\": {\n    \"esri-leaflet\": \"^2.0.0\",\n    \"leaflet\": \"^1.0.0-rc.3\",\n    \"leaflet.heat\": \"^0.2.0\"\n  },\n  \"devDependencies\": {\n    \"chai\": \"2.3.0\",\n    \"gh-release\": \"^2.0.0\",\n    \"http-server\": \"^0.9.0\",\n    \"isparta\": \"^3.0.3\",\n    \"istanbul\": \"^0.4.2\",\n    \"karma\": \"^0.12.24\",\n    \"karma-chai-sinon\": \"^0.1.3\",\n    \"karma-coverage\": \"^0.5.3\",\n    \"karma-mocha\": \"^0.1.0\",\n    \"karma-mocha-reporter\": \"^0.2.5\",\n    \"karma-phantomjs-launcher\": \"^0.1.4\",\n    \"karma-sourcemap-loader\": \"^0.3.5\",\n    \"mkdirp\": \"^0.5.1\",\n    \"node-sass\": \"^3.2.0\",\n    \"phantomjs\": \"^1.9.17\",\n    \"rollup\": \"^0.25.4\",\n    \"rollup-plugin-json\": \"^2.0.0\",\n    \"rollup-plugin-node-resolve\": \"^1.4.0\",\n    \"rollup-plugin-uglify\": \"^0.3.1\",\n    \"semistandard\": \"^7.0.2\",\n    \"sinon\": \"^1.11.1\",\n    \"sinon-chai\": \"2.7.0\",\n    \"snazzy\": \"^2.0.1\",\n    \"watch\": \"^0.17.1\"\n  },\n  \"homepage\": \"https://github.com/Esri/esri-leaflet-heatmap\",\n  \"jsnext:main\": \"src/HeatmapFeatureLayer.js\",\n  \"jspm\": {\n    \"registry\": \"npm\",\n    \"format\": \"es6\",\n    \"main\": \"src/HeatmapFeatureLayer.js\"\n  },\n  \"license\": \"Apache-2.0\",\n  \"main\": \"dist/esri-leaflet-heatmap-debug.js\",\n  \"readmeFilename\": \"README.md\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com:Esri/esri-leaflet-heatmap.git\"\n  },\n  \"scripts\": {\n    \"prebuild\": \"mkdirp dist\",\n    \"build\": \"rollup -c profiles/debug.js & rollup -c profiles/production.js\",\n    \"lint\": \"semistandard src/*.js && semistandard spec/*.js | snazzy\",\n    \"prepublish\": \"npm run build\",\n    \"pretest\": \"npm run build\",\n    \"release\": \"./scripts/release.sh\",\n    \"start\": \"watch 'npm run build' src & http-server -p 6789 -c-1 -o\",\n    \"test\": \"npm run lint && karma start\"\n  }\n}\n","export { version as VERSION } from '../package.json';\n\nimport L from 'leaflet';\nimport { FeatureManager } from 'esri-leaflet';\n\nexport var FeatureLayer = FeatureManager.extend({\n  /**\n   * Constructor\n   */\n\n  initialize: function (options) {\n    FeatureManager.prototype.initialize.call(this, options);\n\n    options = L.setOptions(this, options);\n\n    this._cache = {};\n    this._active = {};\n\n    this.heat = window.L.heatLayer([], options);\n  },\n\n  /**\n   * Layer Interface\n   */\n\n  onAdd: function (map) {\n    FeatureManager.prototype.onAdd.call(this, map);\n    this._map.addLayer(this.heat);\n  },\n\n  onRemove: function (map) {\n    FeatureManager.prototype.onRemove.call(this, map);\n    this._map.removeLayer(this.heat);\n  },\n\n  /**\n   * Feature Managment Methods\n   */\n\n  createLayers: function (features) {\n    for (var i = features.length - 1; i >= 0; i--) {\n      var geojson = features[i];\n      var id = geojson.id;\n      var latlng = new L.LatLng(geojson.geometry.coordinates[1], geojson.geometry.coordinates[0]);\n      this._cache[id] = latlng;\n\n      // add the layer if it is within the time bounds or our layer is not time enabled\n      if (!this._active[id] && (!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson)))) {\n        this._active[id] = latlng;\n        this.heat._latlngs.push(latlng);\n      }\n    }\n\n    this.heat.redraw();\n  },\n\n  addLayers: function (ids) {\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var id = ids[i];\n      if (!this._active[id]) {\n        var latlng = this._cache[id];\n        this.heat._latlngs.push(latlng);\n        this._active[id] = latlng;\n      }\n    }\n    this.heat.redraw();\n  },\n\n  removeLayers: function (ids, permanent) {\n    var newLatLngs = [];\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var id = ids[i];\n      if (this._active[id]) {\n        delete this._active[id];\n      }\n      if (this._cache[id] && permanent) {\n        delete this._cache[id];\n      }\n    }\n\n    for (var latlng in this._active) {\n      newLatLngs.push(this._active[latlng]);\n    }\n\n    this.heat.setLatLngs(newLatLngs);\n  },\n\n  setOptions: function (options) {\n    this.heat.setOptions(options);\n  },\n\n  redraw: function () {\n    this.heat.redraw();\n  }\n\n});\n\nexport function featureLayer (options) {\n  return new FeatureLayer(options);\n}\n\nexport default featureLayer;\n"],"names":["featureLayer","options","FeatureLayer","FeatureManager","extend","initialize","prototype","call","this","L","setOptions","_cache","_active","heat","window","heatLayer","onAdd","map","_map","addLayer","onRemove","removeLayer","createLayers","features","i","length","geojson","id","latlng","LatLng","geometry","coordinates","timeField","_featureWithinTimeRange","_latlngs","push","redraw","addLayers","ids","removeLayers","permanent","newLatLngs","setLatLngs"],"mappings":";;;qUCiGO,SAASA,GAAcC,GAC5B,MAAO,IAAIC,GAAaD,6CA7FfC,EAAeC,iBAAeC,QAKvCC,WAAY,SAAUJ,GACpBE,iBAAeG,UAAUD,WAAWE,KAAKC,KAAMP,GAE/CA,EAAUQ,EAAEC,WAAWF,KAAMP,GAE7BO,KAAKG,UACLH,KAAKI,WAELJ,KAAKK,KAAOC,OAAOL,EAAEM,aAAcd,IAOrCe,MAAO,SAAUC,GACfd,iBAAeG,UAAUU,MAAMT,KAAKC,KAAMS,GAC1CT,KAAKU,KAAKC,SAASX,KAAKK,OAG1BO,SAAU,SAAUH,GAClBd,iBAAeG,UAAUc,SAASb,KAAKC,KAAMS,GAC7CT,KAAKU,KAAKG,YAAYb,KAAKK,OAO7BS,aAAc,SAAUC,GACtB,IAAK,GAAIC,GAAID,EAASE,OAAS,EAAGD,GAAK,EAAGA,IAAK,CAC7C,GAAIE,GAAUH,EAASC,GACnBG,EAAKD,EAAQC,GACbC,EAAS,GAAInB,GAAEoB,OAAOH,EAAQI,SAASC,YAAY,GAAIL,EAAQI,SAASC,YAAY,GACxFvB,MAAKG,OAAOgB,GAAMC,GAGbpB,KAAKI,QAAQe,MAASnB,KAAKP,QAAQ+B,WAAcxB,KAAKP,QAAQ+B,WAAaxB,KAAKyB,wBAAwBP,MAC3GlB,KAAKI,QAAQe,GAAMC,EACnBpB,KAAKK,KAAKqB,SAASC,KAAKP,IAI5BpB,KAAKK,KAAKuB,UAGZC,UAAW,SAAUC,GACnB,IAAK,GAAId,GAAIc,EAAIb,OAAS,EAAGD,GAAK,EAAGA,IAAK,CACxC,GAAIG,GAAKW,EAAId,EACb,KAAKhB,KAAKI,QAAQe,GAAK,CACrB,GAAIC,GAASpB,KAAKG,OAAOgB,EACzBnB,MAAKK,KAAKqB,SAASC,KAAKP,GACxBpB,KAAKI,QAAQe,GAAMC,GAGvBpB,KAAKK,KAAKuB,UAGZG,aAAc,SAAUD,EAAKE,GAE3B,IAAK,GADDC,MACKjB,EAAIc,EAAIb,OAAS,EAAGD,GAAK,EAAGA,IAAK,CACxC,GAAIG,GAAKW,EAAId,EACThB,MAAKI,QAAQe,UACRnB,MAAKI,QAAQe,GAElBnB,KAAKG,OAAOgB,IAAOa,SACdhC,MAAKG,OAAOgB,GAIvB,IAAK,GAAIC,KAAUpB,MAAKI,QACtB6B,EAAWN,KAAK3B,KAAKI,QAAQgB,GAG/BpB,MAAKK,KAAK6B,WAAWD,IAGvB/B,WAAY,SAAUT,GACpBO,KAAKK,KAAKH,WAAWT,IAGvBmC,OAAQ,WACN5B,KAAKK,KAAKuB"}